<!doctype html><html manifest="cache.manifest"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><script src="jquery.min.js"></script><script src="highcharts.js"></script><script>function tmsync(){var e=new Date,t={};t.action="synctime",t.y=e.getYear(),t.m=e.getMonth()+1,t.d=e.getDate(),t.h=e.getHours(),t.mi=e.getMinutes(),t.s=e.getSeconds(),ws.send(JSON.stringify(t))}function on_focus(e){et=e,edit=!0}function on_blur(){et=0,edit=!1}function dbInit(){db.transaction(function(e){e.executeSql("SELECT * FROM testTable",[],function(e,t){var a,i=t.rows.length;for(console.log("Got "+i+" rows."),a=0;i>a;a++)console.log("id: "+t.rows.item(a).id),console.log("name: "+t.rows.item(a).name)})})}var chart,dbflag=0,ws,first=!0,edit=!1,et=0,min={};min.temp=0,min.humi=0,min.speed=0,min.concent=0,min.pressure=0;var max={};max.temp=0,max.humi=0,max.speed=0,max.concent=0,max.pressure=0,String.prototype.startWith=function(e){var t=new RegExp("^"+e);return t.test(this)},"WebSocket"in window||alert("您的浏览器不支持websocekt，建议安装最新的chrome浏览器"),window.openDatabase&&window.localStorage?dbflag=1:alert("您的浏览器不支持本地存储，建议安装最新的chrome浏览器");var ip="";localStorage.hhip&&(ip=localStorage.hhip);var loc=location.hostname;loc.startWith("http://192.168")&&(ip=location.hostname);var db=openDatabase("mydb","1.0","mydb",2097152);db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS data (id unique, temp REAL,humi REAL,speed REAL,pressure REAL,time REAL,illum REAL)")}),$(function(){function e(){ws.close(),ip=$("#ipaddr").val(),$("#container").highcharts(a)}function t(t){if(13===t.keyCode&&edit===!0){var a={};switch(a.action="setpara",et){case 1:a.temp=10*$("#tempSet").val();break;case 2:a.speed=$("#speedSet").val();break;case 3:a.humi=$("#humiSet").val();break;case 4:a.pressure=$("#pressureSet").val();break;case 5:a.time=$("#tmSet").val();break;case 6:a.illum=$("#illumSet").val();break;case 7:a.concent=$("#concentSet").val();break;case 8:return edit=!1,void e()}ws.send(JSON.stringify(a))}}$("#setting").attr("href",ip),$("#ipaddr").val(ip),$("#relay").click(function(){var e={};e.action="setport",ws.send(JSON.stringify(e))}),$("#dbop").click(function(){1===dbflag?(dbflag=2,$("#dbop").html("数据库已打开")):2===dbflag&&(dbflag=1,$("#dbop").html("数据库已关闭"))});var a={chart:{type:"spline",backgroundColor:{linearGradient:[0,0,500,500],stops:[[0,"rgb(255, 255, 255)"],[1,"rgb(200, 200, 255)"]]},animation:Highcharts.svg,marginRight:10,events:{load:function(){var e=this.series[0],t=this.series[1],a=this.series[2],s=this.series[3],n=this.series[4];e.hide(),t.hide(),a.hide(),s.hide(),n.hide(),$("#status").html("设备正在连接中"),ws=new WebSocket("ws://"+ip+":81/",["arduino"]),ws.onopen=function(){$("#status").html("网络已连接"),localStorage.hhip=ip},ws.onerror=function(){$("#status").html("网络连接出错")},ws.onclose=function(){$("#status").html("网络连接关闭")},ws.onmessage=function(r){{var m=JSON.parse(r.data),o=m.dispPara.temp/10,l=m.dispPara.humi,h=m.dispPara.speed,d=m.dispPara.pressure,p=m.dispPara.time,c=m.dispPara.illum,u=m.dispPara.concent;m.dispPara.alarm}if(0===m.dispPara.devid)$("#htbus").html("485通信异常"),e.hide(),t.hide(),a.hide(),s.hide(),n.hide();else{$("#htbus").html("485通讯正常");var f=(new Date).getTime();e.addPoint([f,o],!0,!0),t.addPoint([f,l],!0,!0),a.addPoint([f,h],!0,!0),s.addPoint([f,d],!0,!0),n.addPoint([f,u],!0,!0)}first===!0&&(first=!1,min.temp=max.temp=o,min.humi=max.humi=l,min.speed=max.speed=h,min.concent=max.concent=u,min.pressure=max.pressure=d),$("#time").html(m.modPara.time),$("#date").html(m.modPara.date),$("#dhttemp").html(m.modPara.dhttemp+"℃"),$("#dhthumi").html(m.modPara.dhthumi+"%RH"),$("#num").html(m.modPara.num),$("#adc").html(m.modPara.adc);var b="";if(b=1===m.modPara.relay?"开":"关",$("#relay").html(b),edit===!1){var v=m.setPara.temp/10;v=v.toFixed(1),$("#tempSet").val(v),$("#humiSet").val(m.setPara.humi),$("#speedSet").val(m.setPara.speed),$("#pressureSet").val(m.setPara.pressure),$("#tmSet").val(m.setPara.time),$("#illumSet").val(m.setPara.illum),$("#concentSet").val(m.setPara.concent)}o=o.toFixed(1),$("#temp").html(o),$("#humi").html(l),$("#speed").html(h),$("#pressure").html(d),$("#tm").html(p),$("#illum").html(c),$("#concent").html(u),2===dbflag?(db.transaction(function(e){e.executeSql("INSERT INTO data (temp,humi,speed,pressure,time,illum) VALUES (?,?,?,?,?,?)",[o,l,h,d,p,c])}),$("#db").html("数据库正在记录")):1===dbflag&&$("#db").html("数据库未记录"),m.dispPara.alarm>0?(navigator.vibrate(100),i.play()):i.pause();var x="设备类型: ";switch(m.dispPara.type){case 1:e.show(),x+="干燥/培养/生化系列";break;case 2:e.show(),x+="光照培养箱";break;case 3:e.show(),t.show(),x+="恒温恒湿箱";break;case 4:e.show(),t.show(),x+="人工气候培养";break;case 5:e.show(),x+="配比式CO2培养箱";break;case 6:e.show(),n.show(),x+="红外CO2培养箱";break;case 7:e.show(),a.show(),x+="恒温摇床";break;case 8:e.show(),a.show(),x+="旋蒸/搅拌器";break;case 9:e.show(),s.show(),x+="真空系列";break;case 10:e.show(),x+="消毒柜系列";break;case 11:e.show(),x+="低温系列";break;case 12:e.show(),x+="药品/血液冷藏柜"}$("#type").html(x);var w="报警信息: ";$("#alarm").html(w),o>max.temp&&(max.temp=o),o<min.temp&&(min.temp=o),l>max.humi&&(max.humi=l),l<min.humi&&(min.humi=l),h>max.speed&&(max.speed=h),h<min.speed&&(min.speed=h),d>max.temp&&(max.temp=d),d<min.temp&&(min.temp=d),u>max.temp&&(max.temp=u),u<min.temp&&(min.temp=u),$("#tempMin").html(min.temp),$("#tempMax").html(max.temp),$("#humiMin").html(min.humi),$("#humiMax").html(max.humi),$("#speedMin").html(min.speed),$("#speedMax").html(max.humi),$("#pressureMin").html(min.pressure),$("#pressureMax").html(max.pressure),$("#concentMin").html(min.concent),$("#concentMax").html(max.concent)}}}},title:{text:"测量数据"},xAxis:{type:"datetime",tickPixelInterval:50},yAxis:[{labels:{formatter:function(){return this.value+"°C"},style:{color:"#89A54E"}},title:{text:"Temperature",style:{color:"#89A54E"}},opposite:!0},{labels:{formatter:function(){return this.value+"%RH"},style:{color:"#89A54E"}},title:{text:"Temperature",style:{color:"#89A54E"}},opposite:!0}],tooltip:{shared:!0},legend:{enabled:!0},plotOptions:{spline:{lineWidth:1,states:{hover:{lineWidth:5}},marker:{enabled:!0},enableMouseTracking:!0}},series:[{name:"温度",data:function(){var e,t=[],a=(new Date).getTime();for(e=-19;0>=e;e++)t.push({x:a+1e3*e,y:0});return t}(),tooltip:{valueSuffix:" ℃"}},{name:"湿度",data:function(){var e,t=[],a=(new Date).getTime();for(e=-19;0>=e;e++)t.push({x:a+1e3*e,y:0});return t}(),tooltip:{valueSuffix:" %RH"}},{name:"速度",data:function(){var e,t=[],a=(new Date).getTime();for(e=-19;0>=e;e++)t.push({x:a+1e3*e,y:0});return t}(),tooltip:{valueSuffix:" RPM"}},{name:"压力",data:function(){var e,t=[],a=(new Date).getTime();for(e=-19;0>=e;e++)t.push({x:a+1e3*e,y:0});return t}(),tooltip:{valueSuffix:" KPA"}},{name:"浓度",data:function(){var e,t=[],a=(new Date).getTime();for(e=-19;0>=e;e++)t.push({x:a+1e3*e,y:0});return t}(),tooltip:{valueSuffix:" %"}}]};Highcharts.setOptions({global:{useUTC:!1}});var i=document.getElementById("audio_player");i.pause(),document.onkeydown=t,$("#container").highcharts(a)});</script><style>#main{height:680px;background:#dffaff;margin:10px 50px;border-radius:20px 20px 20px 20px}b{margin:2px 10px 2px 10px;padding-top:4px;font-size:20px;font-family:"楷体" font-weight:700}a,p{float:left;margin:2px 10px 2px 10px;padding-top:4px;font-size:20px;font-family:Georgia,serif;font-weight:700;text-shadow:3px 3px 3px #568F23}h1{float:left}#container{height:100%;width:100%;margin-left:30px;margin-top:20px;float:left}.shadow{filter:progid:DXImageTransform.Microsoft.Shadow(color=#909090, direction=120, strength=4);-moz-box-shadow:2px 2px 10px #909090;-webkit-box-shadow:2px 2px 10px #909090;box-shadow:2px 2px 10px #909090}td{text-align:center}.set{width:50px}</style></head><body><audio controls autoplay id="audio_player" src="/test/msg.mp3" style="display:none">你的浏览器不支持audio</audio><div id="main" class="shadow"><table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0" bordercolor="#009900"><tr bgcolor="#cccccc" height="10%"><td width="25%"><b>模块日期</b></td><td width="15%"><b>模块时间</b></td><td width="15%"><b>环境湿度</b></td><td width="15%"><b>环境温度</b></td><td width="15%"><b>在线数</b></td><td width="15%"><b>模拟量</b></td><td width="10%"><b>继电器</b></td></tr><tr height="5%"><td><p id="date"></p></td><td><p id="time"></p></td><td><p id="dhthumi"></p></td><td><p id="dhttemp"></p></td><td><p id="num"></p></td><td><p id="adc"></p></td><td><p id="relay"></p></td></tr><tr><td><div><p id="msg">消息:</p><br><br><p id="type">设备类型:</p><br><br><table border="1" height="100%" width="100%" cellspacing="0" cellpadding="0"><tr><td width="20%">变量</td><td width="20%">测量值</td><td width="20%">最小值</td><td width="20%">最大值</td><td width="20%">设定值</td></tr><tr><td><p>温度</p></td><td id="temp"></td><td id="tempMin"></td><td id="tempMax"></td><td><input type="text" id="tempSet" class="set" onfocus="on_focus(1)" onblur="on_blur()"></td></tr><tr><td><p>速度</p></td><td id="speed"></td><td id="speedMin"></td><td id="speedMax"></td><td><input type="text" id="speedSet" class="set" onfocus="on_focus(2)" onblur="on_blur()"></td></tr><tr><td><p>湿度</p></td><td id="humi"></td><td id="humiMin"></td><td id="humiMax"></td><td><input type="text" id="humiSet" class="set" onfocus="on_focus(3)" onblur="on_blur()"></td></tr><tr><td><p>浓度</p></td><td id="concent"></td><td id="concentMin"></td><td id="concentMax"></td><td><input type="text" id="concentSet" class="set" onfocus="on_focus(4)" onblur="on_blur()"></td></tr><tr><td><p>时间</p></td><td id="tm"></td><td></td><td></td><td><input type="text" id="tmSet" class="set" onfocus="on_focus(5)" onblur="on_blur()"></td></tr><tr><td><p>压力</p></td><td id="pressure"></td><td id="pressureMin"></td><td id="pressureMax"></td><td><input type="text" id="pressureSet" class="set" onfocus="on_focus(6)" onblur="on_blur()"></td></tr><tr><td><p>光照</p></td><td id="illum"></td><td id="illumMin"></td><td id="illumMax"></td><td><input type="text" id="illumSet" class="set" onfocus="on_focus(7)" onblur="on_blur()"></td></tr></table><p id="dbop">数据库已关闭</p></div></td><td colspan="6"><div id="container"></div></td></tr><tr height="5%"><td><p id="status">正在连接中</p></td><td><p id="htbus">485连接中</p></td><td><p id="db">数据库未记录</p></td><td><input type="text" id="ipaddr" placeholder="输入ip地址并点击连接" onfocus="on_focus(8)" onblur="on_blur()"></td><td><button onclick="tmsync()">同步时间</button></td><td><a href="location.hostname">进入模块设置</a></td></tr></table></div></body></html>